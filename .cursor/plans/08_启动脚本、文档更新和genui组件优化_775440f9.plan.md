---
name: 启动脚本、文档更新和GenUI组件优化
overview: 1. 在根目录创建启动脚本（支持后端、前端、全栈启动）；2. 更新文档标记里程碑2完成；3. 添加纯图片组件并替换所有SmartCanvas使用。
todos:
  - id: create-start-script
    content: 在根目录创建 start.sh 启动脚本，支持后端、前端、全栈三种启动模式
    status: completed
  - id: update-doc-progress
    content: 更新 PROMPT_README.md，标记里程碑2所有任务为已完成
    status: completed
  - id: add-imageview-component
    content: 在 genui-component.interface.ts 中添加 ImageView 组件类型定义
    status: completed
  - id: replace-smartcanvas
    content: 替换 executor.node.ts 和 agent.controller.ts 中所有 SmartCanvas 为 ImageView
    status: completed
---

# 启动脚本、文档更新和 GenUI 组件优化

## 任务概述

1. **创建启动脚本**：在根目录添加便捷启动脚本
2. **更新文档进度**：标记里程碑2已完成
3. **GenUI 组件优化**：添加纯图片组件，替换 SmartCanvas

## 实施步骤

### 1. 创建启动脚本

**文件：** `start.sh`（根目录）

**功能：**

- 支持三种启动模式：
  - `./start.sh backend` - 仅启动后端
  - `./start.sh frontend` - 仅启动前端（预留 Flutter/Next.js 支持）
  - `./start.sh all` - 同时启动前后端

**实现要点：**

- 使用后台进程启动服务
- 支持 Ctrl+C 优雅退出（kill 所有子进程）
- 显示服务启动状态和端口信息
- 前端部分预留接口，当前仅提示（Flutter 启动命令待实现）

**脚本结构：**

```bash
#!/bin/bash
# 启动后端：cd main/server && npm run start:dev
# 启动前端：预留空间（Flutter: flutter run / Next.js: npm run dev）
# 清理函数：trap 信号处理
```

### 2. 更新文档进度

**文件：** `main/server/docs/PROMPT_README.md`

**修改内容：**

- 将里程碑2的所有任务标记为已完成（`- [ ]` → `- [x]`）
- 更新进度说明，记录已完成的工作：
  - 引入 LangGraph ✓
  - 定义 AgentState 数据结构 ✓
  - 实现 Planner Node ✓
  - 实现 Executor Node ✓
  - 验证通过 ✓

### 3. GenUI 组件优化

#### 3.1 添加 ImageView 组件类型

**文件：** `main/server/src/common/types/genui-component.interface.ts`

**修改：**

- 在 `widgetType` 联合类型中添加 `'ImageView'`
- 在 `props` 中添加 `ImageView` 的专用属性：
  ```typescript
  
  
  // ImageView props
  imageUrl?: string;
  width?: number;
  height?: number;
  fit?: 'contain' | 'cover' | 'fill' | 'none' | 'scaleDown';
  ```


#### 3.2 替换所有 SmartCanvas 使用

**需要修改的文件：**

1. **`main/server/src/agent/nodes/executor.node.ts`**

   - 将 `widgetType: 'SmartCanvas'` 改为 `widgetType: 'ImageView'`
   - 更新 props：移除 `mode` 和 `ratio`，保留 `imageUrl`，可添加 `width`、`height`、`fit`

2. **`main/server/src/agent/agent.controller.ts`**

   - 更新 Swagger 文档示例中的 `SmartCanvas` 为 `ImageView`

3. **注释和文档字符串**

   - 更新所有提到 `SmartCanvas` 的注释

## 文件清单

**新建文件：**

- `start.sh` - 启动脚本（根目录）

**修改文件：**

- `main/server/docs/PROMPT_README.md` - 更新里程碑2进度
- `main/server/src/common/types/genui-component.interface.ts` - 添加 ImageView 组件类型
- `main/server/src/agent/nodes/executor.node.ts` - 替换 SmartCanvas 为 ImageView
- `main/server/src/agent/agent.controller.ts` - 更新 Swagger 示例

## 技术细节

### 启动脚本设计

- 使用 `trap` 捕获 SIGINT/SIGTERM 信号
- 使用进程组管理子进程（`set -m`）
- 记录 PID 以便清理
- 前端部分使用条件判断，预留扩展空间

### ImageView 组件属性

- `imageUrl`: 图片 URL（必需）
- `width`: 图片宽度（可选，单位：px 或 dp）
- `height`: 图片高度（可选，单位：px 或 dp）
- `fit`: 图片适配模式（可选，默认 'contain'）

### 替换策略

- 保持向后兼容：SmartCanvas 仍保留在类型定义中（用于未来画布功能）
- ImageView 专门用于纯图片展示场景
- 更新所有生成 ImageView 的代码位置