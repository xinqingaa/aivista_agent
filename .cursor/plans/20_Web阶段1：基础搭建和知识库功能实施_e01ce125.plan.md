---
name: 阶段1：基础搭建和知识库功能实施
overview: 实施阶段1：建立 Next.js 项目基础架构，集成 shadcn/ui 组件库和主题系统，实现知识库 API 集成和管理界面，完成可独立测试的知识库功能。
todos:
  - id: init-project
    content: 创建 Next.js 项目并配置基础设置（TypeScript、TailwindCSS、路径别名）
    status: completed
  - id: setup-shadcn
    content: 初始化 shadcn/ui 并添加基础组件（Button、Card、Input、Textarea、Select、Dialog、Toast）
    status: completed
  - id: setup-theme
    content: 配置主题系统（next-themes、CSS 变量、ThemeProvider、ThemeToggle）
    status: completed
  - id: config-tailwind
    content: 配置 TailwindCSS 自定义颜色（黑色、白色、灰色、绿色、蓝色）
    status: completed
  - id: api-client
    content: 创建 API 客户端（lib/api/client.ts）和知识库 API 封装（lib/api/knowledge.ts）
    status: completed
  - id: knowledge-types
    content: 定义知识库相关 TypeScript 类型（lib/types/knowledge.ts）
    status: completed
  - id: knowledge-page
    content: 创建知识库页面（app/knowledge/page.tsx）
    status: completed
  - id: knowledge-components
    content: 实现知识库组件（StyleList、StyleCard、StyleSearch、StyleForm、StyleDetail、KnowledgeStats）
    status: completed
  - id: knowledge-hooks
    content: 创建知识库自定义 Hooks（hooks/useKnowledge.ts）
    status: completed
  - id: layout-components
    content: 创建布局组件（Header、Footer）
    status: completed
---

# 阶段1：基础搭建和知识库功能实施计划

## 1. 任务1.1：项目初始化

### 1.1 创建 Next.js 项目

- 在 `main/web` 目录下初始化 Next.js 14+ 项目（使用 pnpm）
- 配置 TypeScript、TailwindCSS、App Router
- 创建基础目录结构

**文件清单：**

- `package.json` - 项目依赖配置
- `tsconfig.json` - TypeScript 配置（路径别名 `@/*`）
- `next.config.js` - Next.js 配置（包含 API 代理）
- `tailwind.config.js` - TailwindCSS 配置（自定义颜色、darkMode: 'class'）
- `postcss.config.js` - PostCSS 配置
- `app/layout.tsx` - 根布局（包含 ThemeProvider）
- `app/page.tsx` - 首页（导航到知识库）
- `app/globals.css` - 全局样式（包含 shadcn/ui CSS 变量）
- `.env.local` - 环境变量（NEXT_PUBLIC_API_URL）
- `.gitignore` - Git 忽略文件

**关键配置：**

- 使用 pnpm 作为包管理器
- TypeScript 严格模式
- 路径别名 `@/*` 指向项目根目录
- Next.js rewrites 代理 `/api/*` 到 `http://localhost:3000/api/*`

### 1.2 安装核心依赖

```bash
pnpm add react react-dom next
pnpm add -D @types/react @types/node typescript
pnpm add tailwindcss postcss autoprefixer
pnpm add zustand
pnpm add class-variance-authority clsx tailwind-merge tailwindcss-animate
pnpm add next-themes
```

## 2. 任务1.2：shadcn/ui 集成

### 2.1 初始化 shadcn/ui

- 运行 `npx shadcn-ui@latest init`
- 配置选项：
  - Style: Default
  - Base color: Slate
  - CSS variables: Yes
  - Components: `@/components`
  - Utils: `@/lib/utils`

**文件清单：**

- `components.json` - shadcn/ui 配置文件
- `lib/utils/cn.ts` - className 合并工具函数

### 2.2 添加基础组件

```bash
pnpm dlx shadcn-ui@latest add button
pnpm dlx shadcn-ui@latest add card
pnpm dlx shadcn-ui@latest add input
pnpm dlx shadcn-ui@latest add textarea
pnpm dlx shadcn-ui@latest add select
pnpm dlx shadcn-ui@latest add dialog
pnpm dlx shadcn-ui@latest add toast
pnpm dlx shadcn-ui@latest add dropdown-menu
```

### 2.3 配置主题系统

- 在 `app/globals.css` 中定义 CSS 变量（浅色/深色模式）
- 创建 `components/theme-provider.tsx`（使用 next-themes）
- 创建 `components/theme-toggle.tsx`（主题切换按钮）
- 在 `app/layout.tsx` 中集成 ThemeProvider

**关键文件：**

- `app/globals.css` - 包含 shadcn/ui CSS 变量和自定义颜色变量
- `components/theme-provider.tsx` - ThemeProvider 组件
- `components/theme-toggle.tsx` - 主题切换按钮

### 2.4 配置 TailwindCSS 自定义颜色

- 在 `tailwind.config.js` 中扩展颜色：
  - 主色：black (#000000), white (#FFFFFF)
  - 灰色系：gray-50 到 gray-900
  - 绿色系：green-50 到 green-900（修饰色）
  - 蓝色系：blue-50 到 blue-900（修饰色）
  - shadcn/ui 主题色（使用 CSS 变量）

## 3. 任务1.3：知识库 API 集成

### 3.1 创建 API 客户端

**文件：** `lib/api/client.ts`

- 定义 `API_BASE_URL`（从环境变量读取）
- 定义 `API_ENDPOINTS` 常量
- 实现 `fetchAPI<T>` 函数（处理请求、错误、查询参数）
- 定义 `APIError` 类

### 3.2 实现知识库 API 封装

**文件：** `lib/api/knowledge.ts`

- `getStyles()`: 获取所有风格
- `getStyleById(id: string)`: 获取单个风格
- `searchStyles(options)`: 搜索风格
- `getKnowledgeStats()`: 获取统计信息
- `createStyle(data)`: 添加风格

### 3.3 定义类型

**文件：** `lib/types/knowledge.ts`

- `StyleData` - 风格数据接口
- `SearchOptions` - 搜索选项接口
- `SearchResult` - 搜索结果接口
- `KnowledgeStats` - 统计信息接口
- `CreateStyleRequest` - 创建风格请求接口
- `CreateStyleResponse` - 创建风格响应接口

## 4. 任务1.4：知识库管理界面

### 4.1 创建知识库页面

**文件：** `app/knowledge/page.tsx`

- 主页面组件，包含：
  - 标题和统计信息
  - 搜索栏和添加按钮
  - 风格列表
  - 添加表单（条件渲染）

### 4.2 创建组件

**目录：** `components/features/KnowledgeBase/`

**StyleList.tsx** - 风格列表组件

- 使用 `useEffect` 加载数据
- 支持搜索查询过滤
- 加载状态、错误状态、空状态处理
- 使用 shadcn/ui Card 组件展示

**StyleCard.tsx** - 风格卡片组件

- 显示风格名称、描述、标签
- 点击查看详情
- 响应式设计

**StyleSearch.tsx** - 搜索组件

- 使用 shadcn/ui Input 组件
- 实时搜索（防抖）
- 清空按钮

**StyleForm.tsx** - 添加风格表单

- 使用 shadcn/ui 表单组件（Input, Textarea, Select）
- 表单验证
- 提交处理（调用 createStyle API）
- 成功/错误提示（使用 Toast）

**StyleDetail.tsx** - 风格详情组件

- 使用 shadcn/ui Dialog 组件
- 显示完整风格信息
- 关闭按钮

**KnowledgeStats.tsx** - 统计信息组件

- 使用 shadcn/ui Card 组件
- 显示知识库统计（总数、维度、状态等）
- 加载状态处理

### 4.3 创建自定义 Hook

**文件：** `hooks/useKnowledge.ts`

- 封装知识库相关状态管理
- 提供 `useStyles()`, `useSearchStyles()`, `useKnowledgeStats()` 等 hooks

### 4.4 创建布局组件

**文件：** `components/layout/Header.tsx`

- 导航栏（包含主题切换按钮）
- 响应式设计

**文件：** `components/layout/Footer.tsx`

- 页脚信息

## 5. 验收标准

### 5.1 项目初始化

- [ ] 项目可以正常启动（`pnpm dev`）
- [ ] 页面可以正常访问（`http://localhost:3001`）
- [ ] TypeScript 编译无错误
- [ ] TailwindCSS 样式生效

### 5.2 shadcn/ui 集成

- [ ] shadcn/ui 组件可以正常使用
- [ ] 主题切换功能正常（深色/浅色）
- [ ] 配色方案符合设计（黑色、白色为主）
- [ ] 组件样式大方简洁

### 5.3 知识库 API 集成

- [ ] 可以调用 GET /api/knowledge/styles（返回风格列表）
- [ ] 可以调用 GET /api/knowledge/search（返回搜索结果）
- [ ] 可以调用 GET /api/knowledge/stats（返回统计信息）
- [ ] 可以调用 POST /api/knowledge/styles（成功添加风格）
- [ ] 错误处理正常（网络错误、API 错误）

### 5.4 知识库管理界面

- [ ] 可以查看知识库风格列表
- [ ] 可以搜索风格（实时搜索）
- [ ] 可以查看风格详情（Dialog 弹窗）
- [ ] 可以添加新风格（表单提交）
- [ ] UI 风格符合设计（黑色、白色为主，灰色辅助）
- [ ] 响应式设计正常（PC 端和移动端）

## 6. 前后端联调检查点

### 检查点1：API 连接

```bash


# 测试后端 API 是否可访问
curl http://localhost:3000/api/knowledge/styles
```

### 检查点2：知识库列表

- 前端调用 GET /api/knowledge/styles
- 验证返回数据格式正确
- 验证列表渲染正常

### 检查点3：风格搜索

- 前端调用 GET /api/knowledge/search?query=赛博朋克
- 验证搜索结果正确
- 验证搜索 UI 交互正常

### 检查点4：添加风格

- 前端调用 POST /api/knowledge/styles
- 验证新风格成功添加
- 验证列表自动更新

## 7. 实施顺序

1. **步骤1**：项目初始化（任务1.1）
2. **步骤2**：shadcn/ui 集成（任务1.2）
3. **步骤3**：知识库 API 集成（任务1.3）
4. **步骤4**：知识库管理界面（任务1.4）

每个步骤完成后进行验证，确保无错误后再继续下一步。

## 8. 参考文档

- [项目初始化指南](main/web/docs/development/SETUP.md)
- [技术栈详解](main/web/docs/architecture/TECHNOLOGY_STACK.md)
- [配色方案](main/web/docs/styling/COLOR_SCHEME.md)
- [API 集成指南](main/web/docs/api/API_INTEGRATION.md)
- [知识库功能设计](main/web/docs/features/KNOWLEDGE_BASE.md)
- [后端 API 参考](main/server/docs/api/API_REFERENCE.md)