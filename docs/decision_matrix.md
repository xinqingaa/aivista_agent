# AiVista 技术决策矩阵 (Tech Decision Matrix)

## 1. 核心原则
本项目旨在复刻字节跳动 **即梦 AI (Jimeng)** 的核心架构逻辑。
**关键目标：** 展示 **Flutter 智能画布 (Smart Canvas)** 与 **NestJS Agent 编排** 的协同能力。
**成本策略：** 不在生成质量上投入成本，但在**交互逻辑**和**数据流转**上必须追求 1:1 还原企业级复杂度。

## 2. 模块实现策略 (Real vs. Mock)

| 核心模块 | 对应即梦功能 | 决策 | 实施细节与理由 |
| :--- | :--- | :--- | :--- |
| **Agent 意图识别** | 提示词解析 | **✅ 真实 (DeepSeek)** | **核心大脑。** 真实调用 LLM 解析用户 Prompt，提取 `action`, `style`, `subject`。 |
| **RAG 知识库** | 风格广场 | **✅ 真实 (LanceDB)** | **架构深度。** 当用户输入特定风格词时，必须从本地向量库检索出对应的 Prompt 扩写词。 |
| **文生图 (T2I)** | 画面生成 | **❌ Mock (Picsum)** | **成本控制。** 后端仅模拟 API 延迟 (2s)，返回 `picsum.photos` 随机高清图。 |
| **智能画布 (Inpainting)** | 局部重绘 | **⚠️ 逻辑真，结果假** | **前端核心。** 前端真实实现 `CustomPainter` 绘制 Mask 和坐标映射；后端接收 Mask 后返回新的 Mock 图。 |
| **GenUI 协议** | 动态面板 | **✅ 真实 (Flutter)** | **交互核心。** 后端根据状态动态下发 JSON (如滑块/按钮)，前端动态渲染组件。 |
| **流式传输** | 思考过程 | **✅ 真实 (SSE)** | **体验核心。** 必须实现打字机效果，推送 Agent 的“思考日志”。 |